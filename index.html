<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Sarabun',sans-serif}
    .fade-in{animation:fadeIn .3s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .slide-up{animation:slideUp .3s ease-out}
    @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <!-- Header -->
  <div class="bg-white shadow-lg sticky top-0 z-50">
    <div class="max-w-md mx-auto px-4 py-4">
      <h1 class="text-2xl font-bold text-gray-800 text-center">üìù ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h1>
    </div>
  </div>

  <div class="max-w-md mx-auto px-4 py-6">
    <!-- Filter and Search -->
    <div class="bg-white rounded-2xl shadow-lg p-4 mb-6">
      <div class="flex flex-col gap-3">
        <input id="searchInput" type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" oninput="filterMessages()">
        <select id="categoryFilter" onchange="filterMessages()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <option value="">üìÇ ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
        </select>
      </div>
    </div>

    <!-- Add Message Form -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà</h2>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
        <div class="flex flex-wrap gap-2 mb-3">
          <button onclick="selectCategory('‡∏á‡∏≤‡∏ô', event)" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors">üíº ‡∏á‡∏≤‡∏ô</button>
          <button onclick="selectCategory('‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß', event)" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-700 hover:bg-green-200 transition-colors">üè† ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</button>
          <button onclick="selectCategory('‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢', event)" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors">üí° ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢</button>
          <button onclick="selectCategory('‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç', event)" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition-colors">‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</button>
        </div>
        <input id="customCategory" type="text" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
        <textarea id="messageText" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent h-32 resize-none"></textarea>
      </div>

      <button onclick="addMessage()" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 transform hover:scale-105">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
    </div>

    <!-- Messages Display -->
    <div id="messagesContainer" class="space-y-4"></div>

    <!-- Empty State -->
    <div id="emptyState" class="text-center py-12 hidden">
      <div class="text-6xl mb-4">üìù</div>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
      <p class="text-gray-500">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    </div>
  </div>

  <!-- Message Detail Modal -->
  <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-end justify-center min-h-screen p-4">
      <div class="bg-white rounded-t-3xl w-full max-w-md slide-up">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl" aria-label="‡∏õ‡∏¥‡∏î">√ó</button>
          </div>

          <div id="modalContent"></div>

          <div class="flex gap-3 mt-6">
            <button onclick="editMessage()" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-xl font-medium hover:bg-blue-600 transition-colors">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button onclick="copyMessage()" class="flex-1 bg-indigo-500 text-white py-3 px-4 rounded-xl font-medium hover:bg-indigo-600 transition-colors">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
            <button onclick="deleteMessage()" class="flex-1 bg-red-500 text-white py-3 px-4 rounded-xl font-medium hover:bg-red-600 transition-colors">üóëÔ∏è ‡∏•‡∏ö</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== State ======
    let messages = JSON.parse(localStorage.getItem('messages')) || [];
    let categories = JSON.parse(localStorage.getItem('categories')) || ['‡∏á‡∏≤‡∏ô','‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß','‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢','‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'];
    let selectedCategory = '';
    let currentMessageId = null;

    // ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    const categoryIcons = { '‡∏á‡∏≤‡∏ô':'üíº','‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß':'üè†','‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢':'üí°','‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç':'‚≠ê','default':'üìù' };

    // ====== Helpers ======
    function persist(){
      localStorage.setItem('messages', JSON.stringify(messages));
      localStorage.setItem('categories', JSON.stringify(categories));
    }

    // ====== Category selection ======
    function selectCategory(category, event){
      selectedCategory = category;
      document.getElementById('customCategory').value = '';
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('ring-2','ring-blue-500'));
      if(event) event.target.classList.add('ring-2','ring-blue-500');
    }

    // ====== CRUD ======
    function addMessage(){
      const messageText = document.getElementById('messageText').value.trim();
      const customCategory = document.getElementById('customCategory').value.trim();
      const category = customCategory || selectedCategory || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';

      if(!messageText){ showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°','error'); return; }

      const message = { id: Date.now(), text: messageText, category, timestamp: new Date().toLocaleString('th-TH'), created: Date.now() };
      messages.unshift(message);

      if(!categories.includes(category)){
        categories.push(category);
        updateCategoryFilter();
      }

      persist();

      // reset form
      document.getElementById('messageText').value='';
      document.getElementById('customCategory').value='';
      selectedCategory='';
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('ring-2','ring-blue-500'));

      displayMessages();
      showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ','success');
    }

    function openMessageModal(id){
      const message = messages.find(m=>m.id===id);
      if(!message) return;
      currentMessageId = id;
      const icon = categoryIcons[message.category] || categoryIcons.default;
      document.getElementById('modalContent').innerHTML = `
        <div class="mb-4">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 mb-3">${icon} ${message.category}</span>
          <p class="text-sm text-gray-500 mb-3">${message.timestamp}</p>
          <div class="bg-gray-50 rounded-xl p-4">
            <p class="text-gray-800 leading-relaxed whitespace-pre-wrap">${escapeHtml(message.text)}</p>
          </div>
        </div>`;
      document.getElementById('messageModal').classList.remove('hidden');
    }

    function closeModal(){
      document.getElementById('messageModal').classList.add('hidden');
      currentMessageId = null;
    }

    function editMessage(){
      const message = messages.find(m=>m.id===currentMessageId);
      if(!message) return;
      const newText = prompt('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:', message.text);
      if(newText!==null && newText.trim()){
        message.text = newText.trim();
        message.timestamp = new Date().toLocaleString('th-TH') + ' (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)';
        persist();
        displayMessages();
        closeModal();
        showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úèÔ∏è','info');
      }
    }

    function deleteMessage(){
      if(!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      messages = messages.filter(m=>m.id!==currentMessageId);
      persist();
      displayMessages();
      closeModal();
      showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üóëÔ∏è','success');
    }

    async function copyMessage(){
      const message = messages.find(m=>m.id===currentMessageId);
      if(!message) return;
      try{
        await navigator.clipboard.writeText(message.text);
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß üìã','success');
      }catch(e){
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error');
      }
    }

    // ====== List & Filter ======
    function displayMessages(){
      const container = document.getElementById('messagesContainer');
      const emptyState = document.getElementById('emptyState');

      if(messages.length===0){ container.innerHTML=''; emptyState.classList.remove('hidden'); return; }
      emptyState.classList.add('hidden');

      const filtered = getFilteredMessages();
      if(filtered.length===0){
        container.innerHTML = `<div class="text-center py-8"><div class="text-4xl mb-3">üîç</div><p class="text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p></div>`;
        return;
      }

      container.innerHTML = filtered.map(message=>{
        const icon = categoryIcons[message.category] || categoryIcons.default;
        const preview = message.text.length>100 ? message.text.substring(0,100)+"..." : message.text;
        return `
          <div class="bg-white rounded-2xl shadow-lg p-4 fade-in hover:shadow-xl transition-shadow cursor-pointer" onclick="openMessageModal(${message.id})">
            <div class="flex items-start justify-between mb-3">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">${icon} ${message.category}</span>
              <span class="text-xs text-gray-500">${message.timestamp}</span>
            </div>
            <p class="text-gray-800 leading-relaxed">${escapeHtml(preview)}</p>
            ${message.text.length>100 ? '<p class="text-blue-500 text-sm mt-2">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°...</p>':''}
          </div>`;
      }).join('');
    }

    function getFilteredMessages(){
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const categoryFilter = document.getElementById('categoryFilter').value;
      return messages.filter(m=>{
        const matchesSearch = m.text.toLowerCase().includes(searchTerm) || m.category.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || m.category===categoryFilter;
        return matchesSearch && matchesCategory;
      });
    }

    function filterMessages(){ displayMessages(); }

    function updateCategoryFilter(){
      const select = document.getElementById('categoryFilter');
      const currentValue = select.value;
      select.innerHTML = '<option value="">üìÇ ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>';
      categories.forEach(cat=>{
        const icon = categoryIcons[cat] || categoryIcons.default;
        select.innerHTML += `<option value="${cat}">${icon} ${cat}</option>`;
      });
      select.value = currentValue;
    }

    // ====== Toast ======
    function showToast(message, type='success'){
      const colors = { success:'bg-green-500', error:'bg-red-500', info:'bg-blue-500' };
      const div = document.createElement('div');
      div.className = `fixed top-20 left-1/2 -translate-x-1/2 ${colors[type]||colors.success} text-white px-6 py-3 rounded-xl shadow-lg z-50 fade-in`;
      div.textContent = message;
      document.body.appendChild(div);
      setTimeout(()=>div.remove(), 3000);
    }

    // ====== Utils ======
    function escapeHtml(str){
      return str.replace(/[&<>"]/g, s=>({"&":"&amp;","<":"&lt;",
        ">":"&gt;","\"":"&quot;"}[s]));
    }

    // ====== Modal outside click ======
    document.getElementById('messageModal').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeModal(); });

    // ====== Draft Autosave ======
    let draftTimer;
    const messageInput = document.getElementById('messageText');
    messageInput.addEventListener('input', function(){
      clearTimeout(draftTimer);
      draftTimer = setTimeout(()=> localStorage.setItem('messageDraft', this.value), 1000);
    });

    const draft = localStorage.getItem('messageDraft');
    if(draft) messageInput.value = draft;

    const originalAddMessage = addMessage;
    addMessage = function(){ originalAddMessage(); localStorage.removeItem('messageDraft'); };

    // ====== Init ======
    updateCategoryFilter();
    displayMessages();
  </script>
</body>
</html>
